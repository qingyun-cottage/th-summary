import{d as F,o as _,c as D,F as I,r as rt,n as it,t as k,L as $,s as R,a as dt,b as X,e as z,f as N,g as tt,h as t,u as J,i as W,w as et,j as P,v as B,O as ct,k as q,l as O,m as ot,p as ut,q as pt,x as ht,y as mt,z as nt,A as st,B as lt,C as wt,D as vt}from"./vendor-p7iB914l.js";const gt={class:"fixed_menu"},_t=["onClick"],ft=F({__name:"CheckMenu",props:{menuData:{}},emits:["menuChange"],setup(d,{emit:s}){const e=s,n=r=>{e("menuChange",r.name)};return(r,i)=>(_(),D("div",gt,[(_(!0),D(I,null,rt(r.menuData,(f,m)=>(_(),D("button",{key:m,class:it({active:f.active}),onClick:b=>n(f)},k(f.label),11,_t))),128))]))}}),Y=(d,s)=>{const e=d.__vccOpts||d;for(const[n,r]of s)e[n]=r;return e},yt=Y(ft,[["__scopeId","data-v-734811a0"]]);$.init({appId:"lAoggwjRMvY1wU8S39PdpvJX-gzGzoHsz",appKey:"RNOBEZjkuuXGsMvNEYdJOoIK",serverURL:"https://laoggwjr.lc-cn-n1-shared.com"});const Dt=(d,s)=>$.User.logIn(d,s),bt=(d,s)=>{const e=new $.User;return e.setUsername(d),e.setPassword(s),e.signUp()},kt=()=>$.User.current(),xt=()=>$.User.logOut(),j=async d=>{if(!$.User.current()){R("请先登录");return}return await d()},K=()=>j(()=>new $.Query("th_Data").find()),Ct=d=>{const{power:s,type:e,date:n}=d;return j(()=>{const r=new $.Object("th_Data");return r.set("power",s),r.set("type",e),r.set("date",n),r.save()})},$t=d=>{const{id:s,power:e,type:n,date:r}=d;return j(()=>{const i=$.Object.createWithoutData("th_Data",s);return i.set("power",e),i.set("type",n),i.set("date",r),i.save()})},Mt=d=>j(()=>$.Object.createWithoutData("th_Data",d).destroy()),Tt=async()=>{const d=await K();return j(()=>{$.Object.destroyAll(d)})},St=d=>{const s=d.map(e=>{const n=new $.Object("th_Data");return n.set("power",e.power),n.set("type",e.type),n.set("date",e.date),n});return j(()=>$.Object.saveAll(s))},at=dt("theme",()=>{const[d,s]=window.matchMedia("(prefers-color-scheme: dark)").matches?["dark","light"]:["light","dark"],e=["auto","light","dark"].includes(localStorage.getItem("th_theme")||"")?localStorage.getItem("th_theme"):"auto",n=X({theme:e,autoMode:d,otherMode:s}),r=z(()=>{const b=n.theme==="auto"?n.autoMode:n.otherMode;return document.documentElement.setAttribute("data-theme",b),b}),i=window.matchMedia("(prefers-color-scheme: dark)");function f(b){console.log("系统颜色切换事件"),n.autoMode=b.matches?"dark":"light",n.otherMode=b.matches?"light":"dark"}return i.addEventListener("change",f),{currentTheme:r,toggleTheme:()=>{n.theme=n.theme=="auto"?n.otherMode:"auto",document.documentElement.setAttribute("data-theme",r.value),localStorage.setItem("th_theme",n.theme)}}}),Ut={class:"fixed_right"},Pt={key:0,viewBox:"0 0 24 24",class:"light-icon"},Lt={key:1,viewBox:"0 0 24 24",class:"dark-icon"},Ot={class:"name"},Et={class:"wrapper"},At={class:"inner_box"},Bt={class:"title"},It={class:"form_item"},zt={class:"form_item"},Nt={class:"btn_box"},jt=F({__name:"UserBar",setup(d){const s=at(),e=()=>{s.toggleTheme()},n=N(!1),r=N(""),i=X({showOverlay:!1,title:"",userName:"",password:""});tt(()=>{f()});const f=()=>{const x=kt();x&&(n.value=!0,r.value=x.attributes.username)};let m=()=>{};const b=()=>{i.title="登录",i.showOverlay=!0,m=()=>{Dt(i.userName,i.password).then(x=>{O("登录成功"),A(),window.location.reload()}).catch(x=>{R("登录失败")})}},h=()=>{i.title="注册",i.showOverlay=!0,m=()=>{bt(i.userName,i.password).then(x=>{O("注册成功，自动登录"),A(),window.location.reload()}).catch(x=>{R("注册失败，请联系管理员")})}},T=()=>{m()},E=()=>{Object.assign(i,{showOverlay:!1,userName:"",password:""})},A=()=>{E(),f()},V=()=>{q({title:"提示",message:"确定要退出登录吗？",confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>xt()).then(()=>{n.value=!1,O({message:"退出登录"}),window.location.reload()})};return(x,y)=>(_(),D(I,null,[t("div",Ut,[t("div",{class:"theme_btn",onClick:e},[J(s).currentTheme=="dark"?(_(),D("svg",Pt,y[2]||(y[2]=[t("path",{d:"M6.05 4.14l-.39-.39a.993.993 0 0 0-1.4 0l-.01.01a.984.984 0 0 0 0 1.4l.39.39c.39.39 1.01.39 1.4 0l.01-.01a.984.984 0 0 0 0-1.4zM3.01 10.5H1.99c-.55 0-.99.44-.99.99v.01c0 .55.44.99.99.99H3c.56.01 1-.43 1-.98v-.01c0-.56-.44-1-.99-1zm9-9.95H12c-.56 0-1 .44-1 .99v.96c0 .55.44.99.99.99H12c.56.01 1-.43 1-.98v-.97c0-.55-.44-.99-.99-.99zm7.74 3.21c-.39-.39-1.02-.39-1.41-.01l-.39.39a.984.984 0 0 0 0 1.4l.01.01c.39.39 1.02.39 1.4 0l.39-.39a.984.984 0 0 0 0-1.4zm-1.81 15.1l.39.39a.996.996 0 1 0 1.41-1.41l-.39-.39a.993.993 0 0 0-1.4 0c-.4.4-.4 1.02-.01 1.41zM20 11.49v.01c0 .55.44.99.99.99H22c.55 0 .99-.44.99-.99v-.01c0-.55-.44-.99-.99-.99h-1.01c-.55 0-.99.44-.99.99zM12 5.5c-3.31 0-6 2.69-6 6s2.69 6 6 6s6-2.69 6-6s-2.69-6-6-6zm-.01 16.95H12c.55 0 .99-.44.99-.99v-.96c0-.55-.44-.99-.99-.99h-.01c-.55 0-.99.44-.99.99v.96c0 .55.44.99.99.99zm-7.74-3.21c.39.39 1.02.39 1.41 0l.39-.39a.993.993 0 0 0 0-1.4l-.01-.01a.996.996 0 0 0-1.41 0l-.39.39c-.38.4-.38 1.02.01 1.41z",fill:"currentColor"},null,-1)]))):(_(),D("svg",Lt,y[3]||(y[3]=[t("path",{d:"M11.01 3.05C6.51 3.54 3 7.36 3 12a9 9 0 0 0 9 9c4.63 0 8.45-3.5 8.95-8c.09-.79-.78-1.42-1.54-.95A5.403 5.403 0 0 1 11.1 7.5c0-1.06.31-2.06.84-2.89c.45-.67-.04-1.63-.93-1.56z",fill:"currentColor"},null,-1)])))]),n.value?(_(),D(I,{key:0},[t("span",Ot,k(r.value),1),t("button",{onClick:V},"退出登录")],64)):(_(),D(I,{key:1},[t("button",{onClick:b},"登录"),t("button",{onClick:h},"注册")],64))]),W(J(ct),{show:i.showOverlay},{default:et(()=>[t("div",Et,[t("div",At,[t("div",Bt,k(i.title),1),t("div",It,[y[4]||(y[4]=t("span",null,"用户",-1)),P(t("input",{type:"text","onUpdate:modelValue":y[0]||(y[0]=L=>i.userName=L),placeholder:"用户名"},null,512),[[B,i.userName]])]),t("div",zt,[y[5]||(y[5]=t("span",null,"密码",-1)),P(t("input",{type:"password","onUpdate:modelValue":y[1]||(y[1]=L=>i.password=L),placeholder:"请输入密码"},null,512),[[B,i.password]])]),t("div",Nt,[t("button",{onClick:E},"取消"),t("button",{onClick:T},k(i.title),1)])])])]),_:1},8,["show"])],64))}}),Vt=Y(jt,[["__scopeId","data-v-551ce148"]]);function Rt(d){const s=document.createElement("input");s.type="file",s.onchange=()=>{var n;const e=(n=s.files)==null?void 0:n[0];if(e){const r=new FileReader;r.onload=i=>{const f=i.target.result;d(f)},r.readAsText(e)}},s.click()}function Ft(d,s){const e=new Blob([s],{type:"text/plain"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=d,r.click(),URL.revokeObjectURL(n)}const Yt={class:"basic_usage"},Ht={class:"top_box"},qt={class:"add_box"},Jt={value:"1"},Wt={value:"2"},Kt={class:"list_box"},Xt={class:"item"},Gt={class:"list_content"},Qt={class:"opt"},Zt=["onClick"],te=["onClick"],ee={class:"wrapper"},ae={class:"update_box"},oe={class:"form_item"},ne={class:"form_item"},se={class:"form_item"},le={value:"1"},re={value:"2"},ce=F({__name:"BasicUsage",setup(d){const s={1:"初号机",2:"贰号机"},e=X({addData:{date:null,power:null,type:"1"},showUpdateDialog:!1,list:[],sort:2,updateData:{}});tt(()=>{n()});const n=()=>{K().then(p=>{e.list=p.map(o=>({id:o.id,...o.attributes}))}).catch(p=>{})},r=z(()=>{const p=e.list.slice().sort((o,a)=>e.sort===1?new Date(o.date).getTime()-new Date(a.date).getTime():new Date(a.date).getTime()-new Date(o.date).getTime());return p.sum=p.reduce((o,a)=>o+a.power,0),p}),i=z(()=>e.sort===1?"升序":"降序"),f=()=>{e.sort=e.sort===1?2:1},m=N(0),b=()=>{m.value+=1,m.value>6&&(m.value=0)},h=z(()=>m.value===6),T=()=>{if(!e.addData.date||!e.addData.power){R("请输入日期或内容");return}Ct(e.addData).then(()=>{O("添加成功"),n()})},E=p=>{e.updateData={id:p.id,date:p.date,power:p.power,type:p.type},e.showUpdateDialog=!0},A=()=>{e.showUpdateDialog=!1},V=()=>{$t(e.updateData).then(()=>{O("修改成功"),e.showUpdateDialog=!1,n()})},x=p=>{q({title:"提示",message:"确定删除吗？"}).then(()=>Mt(p.id)).then(()=>{O("删除成功"),n()}).catch(()=>{})},y=()=>{Rt(o=>{try{const a=JSON.parse(o);p(a)}catch{R("文件解析失败")}});function p(o){q({title:"确认导入",message:`共 ${o.length} 条数据，
将删除原有所有数据，
写入新的数据

是否导入？`}).then(()=>Tt()).then(()=>St(o)).then(()=>{O("导入成功"),n()})}},L=()=>{console.log("导出"),K().then(async p=>{try{await q({title:"确认导出",message:`共${p.length}条数据，
是否确认导出？`});const o=p.map(C=>({...C.attributes})),c=`th-summary-data-${ut().format("YYYYMMDDHHmmss")}.json`,g=JSON.stringify(o);Ft(c,g),pt({title:"提示",message:"数据导出成功"})}catch{}})};return(p,o)=>(_(),D("div",Yt,[o[18]||(o[18]=t("h2",{class:"title"},"TH 汎用ヒト型決戦兵器",-1)),t("div",Ht,[t("button",{onClick:y},"导入数据"),t("button",{onClick:L},"导出数据"),t("button",{class:"right",onClick:f},k(i.value),1)]),t("div",qt,[o[7]||(o[7]=t("span",null,"日期",-1)),P(t("input",{class:"input",type:"date","onUpdate:modelValue":o[0]||(o[0]=a=>e.addData.date=a)},null,512),[[B,e.addData.date]]),o[8]||(o[8]=t("span",null,"战力",-1)),P(t("input",{class:"input",type:"number",placeholder:"请输入内容","onUpdate:modelValue":o[1]||(o[1]=a=>e.addData.power=a)},null,512),[[B,e.addData.power]]),o[9]||(o[9]=t("span",null,"类型",-1)),P(t("select",{class:"input select","onUpdate:modelValue":o[2]||(o[2]=a=>e.addData.type=a)},[t("option",Jt,k(s[1]),1),t("option",Wt,k(s[2]),1)],512),[[ot,e.addData.type]]),t("button",{onClick:o[3]||(o[3]=a=>T())},"添加")]),t("div",Kt,[t("div",Xt,[o[10]||(o[10]=t("span",null,"序号",-1)),o[11]||(o[11]=t("span",null,"日期",-1)),o[12]||(o[12]=t("span",null,"战力",-1)),o[13]||(o[13]=t("span",null,"类型",-1)),t("span",{class:"opt",onClick:b},k(h.value?r.value.sum:"操作"),1)]),t("div",Gt,[(_(!0),D(I,null,rt(r.value,(a,c)=>(_(),D("div",{class:"item",key:c},[t("span",null,k(c+1||a.id),1),t("span",null,k(a.date),1),t("span",null,k(a.power),1),t("span",null,k(s[a.type]),1),t("span",Qt,[t("button",{onClick:g=>E(a)},"修改",8,Zt),t("button",{onClick:g=>x(a)},"删除",8,te)])]))),128))])]),W(J(ct),{show:e.showUpdateDialog},{default:et(()=>[t("div",ee,[t("div",ae,[o[17]||(o[17]=t("div",{class:"title_text"},[t("span",null,"修改")],-1)),t("div",oe,[o[14]||(o[14]=t("span",null,"日期",-1)),P(t("input",{class:"input",type:"date","onUpdate:modelValue":o[4]||(o[4]=a=>e.updateData.date=a)},null,512),[[B,e.updateData.date]])]),t("div",ne,[o[15]||(o[15]=t("span",null,"战力",-1)),P(t("input",{class:"input",type:"number",placeholder:"请输入内容","onUpdate:modelValue":o[5]||(o[5]=a=>e.updateData.power=a)},null,512),[[B,e.updateData.power]])]),t("div",se,[o[16]||(o[16]=t("span",null,"类型",-1)),P(t("select",{class:"input select","onUpdate:modelValue":o[6]||(o[6]=a=>e.updateData.type=a)},[t("option",le,k(s[1]),1),t("option",re,k(s[2]),1)],512),[[ot,e.updateData.type]])]),t("div",{class:"btn_box"},[t("button",{onClick:A},"取消"),t("button",{onClick:V},"保存")])])])]),_:1},8,["show"])]))}}),ie=Y(ce,[["__scopeId","data-v-9d278e0d"]]),de={class:"data_visual"},ue={key:0},pe={class:"btn_box"},he={class:"b1"},me={class:"b2"},we=F({__name:"DataVisual",setup(d){const s=at(),e=z(()=>s.currentTheme==="dark"?"#fff":"#333"),n=N("");ht(()=>s.currentTheme,()=>{n.value&&T(n.value)});const r=N([]),i=async()=>{const a=await K();if(a.length===0)throw new Error("暂无数据");r.value=a.map(c=>({id:c.id,...c.attributes})).sort((c,g)=>new Date(c.date).getTime()-new Date(g.date).getTime())};let f=null,m=null;const b=z(()=>r.value.length==0);tt(()=>{i().then(()=>{f=document.getElementById("main"),m=mt(f),T("all_month")}).catch(a=>{})});const h=X({show:!1,year:new Date().getFullYear(),month:new Date().getMonth()+1}),T=a=>{switch(n.value=a,a){case"all":h.show=!1,p(void 0);break;case"all_month":h.show=!1,L();break;case"this_month":E();break}},E=()=>{h.month=new Date().getMonth()+1,h.year=new Date().getFullYear(),h.show=!0,x()},A=()=>{h.month>1?h.month--:(h.month=12,h.year--),x()},V=()=>{h.month<12?h.month++:(h.month=1,h.year++),x()},x=()=>{const{year:a,month:c}=h;p({year:a,month:c})},y=(a=[],c=[],g=[],C="平均能耗")=>{m.clear();let M={title:{text:C,subtext:"单位：KWh",right:"0",textStyle:{color:e.value}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{color:"#ffffff"},crossStyle:{color:e.value}},formatter:function(u){let w=0;return u.forEach(U=>{w+=U.value}),u[0].name+"<br/>"+u[0].marker+u[0].seriesName+" : "+u[0].value+"<br/>"+u[1].marker+u[1].seriesName+" : "+u[1].value+"<br/>合计 : "+w}},legend:{data:["初号机","贰号机"],textStyle:{color:e.value},left:0},grid:{left:"0%",right:"3%",bottom:"45",top:"72",containLabel:!0},xAxis:[{type:"category",data:a,axisPointer:{type:"shadow"},axisLabel:{show:!0,color:e.value}}],yAxis:[{type:"value",nameTextStyle:{color:"#ffffff"},min:0,axisLabel:{color:e.value},splitLine:{show:!0,lineStyle:{type:"dotted"}}}],series:[{name:"初号机",type:"bar",stack:"th",data:c,itemStyle:{color:"#5472c6"},label:{show:!1,formatter:function(u){return u.value!==0?u.value:""}}},{name:"贰号机",type:"bar",stack:"th",data:g,itemStyle:{color:"#d36531"},label:{show:!0,position:"top",color:e.value,formatter:function(u){let w=c[u.dataIndex],U=g[u.dataIndex];return w+U||""}}}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100,handleSize:"80%",handleStyle:{color:"#d3dee5",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}}]};m.setOption(M),window.addEventListener("resize",()=>{m.resize()})},L=()=>{const a=r.value,c=l=>{const[v,S]=l.split("-");return new Date(v,S-1)},g=c(a[0].date),C=c(a[a.length-1].date),M=[];let u=new Date(g);for(;u<=C;){const l=u.getFullYear(),v=String(u.getMonth()+1).padStart(2,"0");M.push(`${l}-${v}`),u.setMonth(u.getMonth()+1)}const w=new Map;a.forEach(l=>{const[v,S]=l.date.split("-"),Q=`${v}-${S}`,Z=w.get(Q)||{month:Q,totalPower1:0,totalPower2:0};l.type=="1"?Z.totalPower1+=l.power:Z.totalPower2+=l.power,w.set(Q,Z)}),M.forEach(l=>{w.has(l)||w.set(l,{month:l,totalPower1:0,totalPower2:0})});const U=M.map(l=>w.get(l).totalPower1),H=M.map(l=>w.get(l).totalPower2),G=o([...w.values()].map(l=>l.totalPower1+l.totalPower2));y(M,U,H,`月均能耗 ：${G}`)},p=a=>{const c=r.value;let g="总和能耗",C=new Date(c[0].date),M=new Date(c[c.length-1].date);a&&(g=a.year+"年"+a.month+"月能耗",C=new Date(a.year,a.month-1,1),M=new Date(a.year,a.month,0));const u=[];for(;C<=M;){const l=C.getFullYear(),v=String(C.getMonth()+1).padStart(2,"0"),S=String(C.getDate()).padStart(2,"0");u.push(`${l}-${v}-${S}`),C.setDate(C.getDate()+1)}const w=new Map;c.forEach(l=>{const v=l.date,S=w.get(v)||{date:v,totalPower1:0,totalPower2:0};l.type=="1"?S.totalPower1+=l.power:S.totalPower2+=l.power,w.set(v,S)}),u.forEach(l=>{w.has(l)||w.set(l,{date:l,totalPower1:0,totalPower2:0})});const U=u.map(l=>w.get(l).totalPower1),H=u.map(l=>w.get(l).totalPower2),G=U.reduce((l,v)=>l+v)+H.reduce((l,v)=>l+v);y(u,U,H,`${g} ：${G}`)};function o(a){return(a.reduce((c,g)=>c+g,0)/a.length).toFixed(2)}return(a,c)=>(_(),D("div",de,[c[4]||(c[4]=t("h2",{class:"title"},"数据展示",-1)),b.value?(_(),D("span",ue,"暂无数据")):(_(),D(I,{key:1},[c[3]||(c[3]=t("div",{id:"main"},null,-1)),t("div",pe,[t("div",he,[t("button",{onClick:c[0]||(c[0]=g=>T("all"))},"全部"),t("button",{onClick:c[1]||(c[1]=g=>T("all_month"))},"按月总览")]),t("div",me,[h.show?(_(),D("button",{key:0,onClick:A},"上个月")):nt("",!0),t("button",{onClick:c[2]||(c[2]=g=>T("this_month"))},"本月"),h.show?(_(),D("button",{key:1,onClick:V},"下个月")):nt("",!0)])])],64))]))}}),ve=Y(we,[["__scopeId","data-v-4286766f"]]),ge={class:"head"},_e={class:"content"},fe=F({__name:"App",setup(d){const s=at(),e=N([{name:"BasicUsage",label:"基础数据",component:st(ie),active:!0},{name:"DataVisual",label:"数据可视化",component:st(ve),active:!1}]),n=r=>{e.value.forEach(i=>{i.active=i.name===r})};return(r,i)=>{const f=wt("van-config-provider");return _(),lt(f,{theme:J(s).currentTheme},{default:et(()=>{var m;return[t("header",ge,[W(yt,{menuData:e.value,onMenuChange:n},null,8,["menuData"]),W(Vt)]),t("div",_e,[(_(),lt(vt((m=e.value.find(b=>b.active))==null?void 0:m.component)))])]}),_:1},8,["theme"])}}}),De=Y(fe,[["__scopeId","data-v-1bfab150"]]);export{De as A};
